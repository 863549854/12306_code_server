FROM arm32v7/python:3.7-buster

LABEL maintainer="Yin Aoxiong <yinaoxiong@gmail.com>" \
      reference="https://github.com/yinaoxiong/12306_code_server"

WORKDIR /app

COPY qemu/qemu-arm-static /usr/bin/qemu-arm-static
COPY requirements.txt requirements.txt

RUN set -ex && \
            apt-get update && \
            apt-get install -y build-essential python3-dev libhdf5-dev \
            gfortran libopenblas-dev liblapack-dev && \
            rm -rf /var/lib/apt/lists/* && \
            pip install --no-cache-dir Cython && \
            pip install --no-cache-dir https://github.com/lhelontra/tensorflow-on-arm/releases/download/v1.14.0-buster/tensorflow-1.14.0-cp37-none-linux_armv7l.whl && \
            pip install --no-cache-dir -r requirements.txt
